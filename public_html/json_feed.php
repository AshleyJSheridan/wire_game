<?php

$pdo = new PDO("mysql:dbname=wire_game;host=localhost", 'root', '', array(PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES 'UTF8'"));

session_start();
$negative_threshold = 5;	// determines how much in terms of % that a movement can be recognised as going backwards legitimately
$positive_threshold = 10;

$markers = array(
0.25=>'25,54.1', 
0.5=>'24.5,53.5', 
0.75=>'24.1,52.9', 
1=>'23.7,52.3', 
1.25=>'23.3,51.6', 
1.5=>'22.9,51', 
1.75=>'22.5,50.4',                                                                                                                                           
2=>'22,49.8',                                                                                                                                                
2.25=>'21.6,49.2',                                                                                                                                           
2.5=>'21.2,48.5',                                                                                                                                            
2.75=>'20.8,47.9',                                                                                                                                           
3=>'20.4,47.3',                                                                                                                                              
3.25=>'20,46.7',                                                                                                                                             
3.5=>'19.5,46.1',                                                                                                                                            
3.75=>'19.1,45.4',                                                                                                                                           
4=>'18.7,44.8',                                                                                                                                              
4.25=>'18.3,44.2',                                                                                                                                           
4.5=>'17.9,43.6',                                                                                                                                            
4.75=>'17.5,43',                                                                                                                                             
5=>'17,42.3',                                                                                                                                                
5.25=>'16.6,41.7',                                                                                                                                           
5.5=>'16.2,41.1',                                                                                                                                            
5.75=>'15.8,40.5',                                                                                                                                           
6=>'15.4,39.9',                                                                                                                                              
6.25=>'15,39.2',                                                                                                                                             
6.5=>'14.5,38.6',                                                                                                                                            
6.75=>'14.1,38',                                                                                                                                             
7=>'13.4,38', 
7.25=>'12.7,38', 
7.5=>'12,37.9', 
7.75=>'11.3,37.9', 
8=>'10.6,37.9', 
8.25=>'9.8,37.9', 
8.5=>'9.1,37.9', 
8.75=>'8.7,37.2', 
9=>'8.3,36.5', 
9.25=>'7.9,35.8', 
9.5=>'7.5,35.1', 
9.75=>'7.1,34.4', 
10=>'7.9,34.3', 
10.25=>'8.6,34.3', 
10.5=>'9.4,34.3', 
10.75=>'10.1,34.2', 
11=>'10.9,34.2', 
11.25=>'11.6,34.1', 
11.5=>'11.3,33.5', 
11.75=>'10.9,32.8', 
12=>'10.6,32.2', 
12.25=>'10.2,31.5', 
12.5=>'9.8,30.9', 
12.75=>'9.5,30.2', 
13=>'9.1,29.6', 
13.25=>'8.8,28.9', 
13.5=>'8.4,28.3', 
13.75=>'8.1,27.6', 
14=>'7.7,27', 
14.25=>'7.3,26.3', 
14.5=>'7,25.7', 
14.75=>'6.6,25', 
15=>'6.3,24.4', 
15.25=>'5.9,23.7', 
15.5=>'5.6,23.1', 
15.75=>'5.2,22.4', 
16=>'4.8,21.8', 
16.25=>'4.5,21.1', 
16.5=>'4.1,20.5', 
16.75=>'4.9,20.4', 
17=>'5.6,20.3', 
17.25=>'6.4,20.3', 
17.5=>'7.1,20.2', 
17.75=>'7.9,20.1', 
18=>'8.6,20', 
18.25=>'9,20.6', 
18.5=>'9.3,21.3', 
18.75=>'9.6,21.9', 
19=>'10,22.6', 
19.25=>'10.3,23.2', 
19.5=>'10.6,23.9', 
19.75=>'11,24.5', 
20=>'11.3,25.1', 
20.25=>'11.6,25.8', 
20.5=>'12,26.4', 
20.75=>'12.3,27.1', 
21=>'12.6,27.7', 
21.25=>'13,28.3', 
21.5=>'13.3,29', 
21.75=>'13.7,29.6', 
22=>'14,30.3', 
22.25=>'14.3,30.9', 
22.5=>'14.7,31.6', 
22.75=>'15,32.2', 
23=>'15.3,32.8', 
23.25=>'15.7,33.5', 
23.5=>'16,34.1', 
23.75=>'16.8,34.2', 
24=>'17.5,34.2', 
24.25=>'18.3,34.3', 
24.5=>'19,34.4', 
24.75=>'19.8,34.4', 
25=>'20.5,34.5', 
25.25=>'21.3,34.5', 
25.5=>'22,34.6', 
25.75=>'22.8,34.6', 
26=>'23.5,34.7', 
26.25=>'24.3,34.8', 
26.5=>'24.6,35.5', 
26.75=>'24.9,36.3', 
27=>'25.2,37', 
27.25=>'25.5,37.8', 
27.5=>'25.8,38.5', 
27.75=>'25,38.5', 
28=>'24.2,38.5', 
28.25=>'23.5,38.5', 
28.5=>'22.7,38.5', 
28.75=>'21.9,38.4', 
29=>'21.2,38.4', 
29.25=>'20.4,38.4', 
29.5=>'19.7,38.4', 
29.75=>'18.9,38.4', 
30=>'18.1,38.4', 
30.25=>'18.5,39', 
30.5=>'18.9,39.6', 
30.75=>'19.3,40.2', 
31=>'19.8,40.8', 
31.25=>'20.2,41.4', 
31.5=>'20.6,42', 
31.75=>'21,42.6', 
32=>'21.4,43.2', 
32.25=>'21.8,43.8', 
32.5=>'22.2,44.4', 
32.75=>'22.6,45', 
33=>'23,45.6', 
33.25=>'23.4,46.2', 
33.5=>'23.8,46.8', 
33.75=>'24.2,47.4', 
34=>'24.6,48', 
34.25=>'25.1,48.6', 
34.5=>'25.5,49.2', 
34.75=>'25.9,49.8', 
35=>'26.3,50.4', 
35.25=>'26.7,51', 
35.5=>'27.1,51.6', 
35.75=>'27.5,52.3', 
36=>'28.3,52.3', 
36.25=>'29,52.3', 
36.5=>'29.8,52.3', 
36.75=>'30.6,52.3', 
37=>'31.3,52.3', 
37.25=>'32.1,52.3', 
37.5=>'32.8,52.3', 
37.75=>'33.6,52.4', 
38=>'34.4,52.4', 
38.25=>'35.1,52.4', 
38.5=>'34.8,51.7', 
38.75=>'34.5,51', 
39=>'34.2,50.3', 
39.25=>'33.9,49.6', 
39.5=>'33.7,48.9', 
39.75=>'33.4,48.2', 
40=>'33.1,47.5', 
40.25=>'32.8,46.9', 
40.5=>'32.5,46.2', 
40.75=>'32.2,45.5', 
41=>'31.9,44.8', 
41.25=>'31.6,44.1', 
41.5=>'31.3,43.4', 
41.75=>'31,42.7', 
42=>'30.7,42', 
42.25=>'30.4,41.3', 
42.5=>'30.1,40.6', 
42.75=>'29.8,40', 
43=>'29.5,39.3', 
43.25=>'29.2,38.6', 
43.5=>'28.9,37.9', 
43.75=>'28.6,37.2', 
44=>'28.3,36.5', 
44.25=>'28,35.8', 
44.5=>'27.8,35.1', 
44.75=>'28.5,35', 
45=>'29.2,34.9', 
45.25=>'29.9,34.8', 
45.5=>'30.7,34.6', 
45.75=>'31.4,34.5', 
46=>'31.9,35.1', 
46.25=>'32.4,35.7', 
46.5=>'32.9,36.3', 
46.75=>'33.4,36.9', 
47=>'33.9,37.5', 
47.25=>'34.6,37.1', 
47.5=>'35.2,36.7', 
47.75=>'35.9,36.2', 
48=>'36.6,35.8', 
48.25=>'37.3,35.4', 
48.5=>'38,35.3', 
48.75=>'38.8,35.2', 
49=>'39.5,35.2', 
49.25=>'40.3,35.1', 
49.5=>'41,35', 
49.75=>'41.8,34.9', 
50=>'42.5,34.9', 
50.25=>'43.1,35.3', 
50.5=>'43.7,35.7', 
50.75=>'44.3,36', 
51=>'44.9,36.4', 
51.25=>'45.5,36.8', 
51.5=>'46.2,37.2', 
51.75=>'46.8,37.6', 
52=>'47.4,38', 
52.25=>'48.1,37.6', 
52.5=>'48.8,37.3', 
52.75=>'49.5,36.9', 
53=>'50.2,36.5', 
53.25=>'50.9,36.1', 
53.5=>'51.6,35.8', 
53.75=>'52.3,35.4', 
54=>'53,35.3', 
54.25=>'53.8,35.3', 
54.5=>'54.5,35.3', 
54.75=>'55.3,35.2', 
55=>'56,35.2', 
55.25=>'56.8,35.1', 
55.5=>'57.3,35.5', 
55.75=>'57.9,35.9', 
56=>'58.4,36.3', 
56.25=>'59,36.7', 
56.5=>'59.5,37.1', 
56.75=>'59.9,37.8', 
57=>'60.3,38.6', 
57.25=>'60.7,39.3', 
57.5=>'61.1,40', 
57.75=>'61,40.7', 
58=>'60.9,41.4', 
58.25=>'60.7,42.1', 
58.5=>'60.6,42.8', 
58.75=>'60.5,43.6', 
59=>'60.3,44.3', 
59.25=>'60.2,45', 
59.5=>'60.1,45.7', 
59.75=>'59.9,46.4', 
60=>'59.8,47.1', 
60.25=>'59.7,47.8', 
60.5=>'59.5,48.5', 
60.75=>'59.4,49.2', 
61=>'59.3,49.9', 
61.25=>'59.2,50.7', 
61.5=>'59,51.4', 
61.75=>'58.9,52.1', 
62=>'58.8,52.8', 
62.25=>'58.6,53.5', 
62.5=>'59.4,53.5', 
62.75=>'60.1,53.6', 
63=>'60.9,53.6', 
63.25=>'61.6,53.6', 
63.5=>'62.4,53.7', 
63.75=>'63.1,53.7', 
64=>'63.9,53.7', 
64.25=>'64.6,53.8', 
64.5=>'64.7,53', 
64.75=>'64.7,52.3', 
65=>'64.7,51.6', 
65.25=>'64.8,50.8', 
65.5=>'64.8,50.1', 
65.75=>'64.8,49.4', 
66=>'64.9,48.6', 
66.25=>'64.9,47.9', 
66.5=>'65,47.2', 
66.75=>'65,46.5', 
67=>'65,45.7', 
67.25=>'65.1,45', 
67.5=>'65.1,44.3', 
67.75=>'65.1,43.5', 
68=>'65.2,42.8', 
68.25=>'65.2,42.1', 
68.5=>'65.2,41.4', 
68.75=>'65.3,40.6', 
69=>'65.3,39.9', 
69.25=>'65.4,39.2', 
69.5=>'65.4,38.4', 
69.75=>'65.4,37.7', 
70=>'65.5,37', 
70.25=>'65.5,36.3', 
70.5=>'66.2,36.1', 
70.75=>'67,36', 
71=>'67.7,35.9', 
71.25=>'68.4,35.8', 
71.5=>'69.1,35.7', 
71.75=>'69.9,35.6', 
72=>'69.8,36.4', 
72.25=>'69.7,37.1', 
72.5=>'69.6,37.8', 
72.75=>'69.5,38.6', 
73=>'69.5,39.3', 
73.25=>'69.4,40', 
73.5=>'69.3,40.8', 
73.75=>'69.2,41.5', 
74=>'69.1,42.2', 
74.25=>'69.1,43', 
74.5=>'69,43.7', 
74.75=>'68.9,44.4', 
75=>'68.8,45.2', 
75.25=>'68.7,45.9', 
75.5=>'68.7,46.6', 
75.75=>'68.6,47.4', 
76=>'68.5,48.1', 
76.25=>'68.4,48.8', 
76.5=>'68.3,49.6', 
76.75=>'68.2,50.3', 
77=>'68.2,51', 
77.25=>'68.1,51.8', 
77.5=>'68,52.5', 
77.75=>'68.5,52', 
78=>'69,51.4', 
78.25=>'69.5,50.9', 
78.5=>'70,50.3', 
78.75=>'70.5,49.8', 
79=>'71.1,49.2', 
79.25=>'71.6,48.7', 
79.5=>'72.1,48.1', 
79.75=>'72.6,47.6', 
80=>'73.1,47.1', 
80.25=>'73.6,46.5', 
80.5=>'74.1,46', 
80.75=>'74.6,45.4', 
81=>'75.1,44.9', 
81.25=>'75.8,44.7', 
81.5=>'76.4,44.5', 
81.75=>'77.1,44.3', 
82=>'77.7,44.1', 
82.25=>'78.4,43.9', 
82.5=>'78.8,44.4', 
82.75=>'79.3,44.9', 
83=>'79.8,45.5', 
83.25=>'80.3,46', 
83.5=>'80.1,46.7', 
83.75=>'79.9,47.4', 
84=>'79.8,48.1', 
84.25=>'79.6,48.8', 
84.5=>'79.4,49.5', 
84.75=>'79.3,50.2', 
85=>'79.1,50.9', 
85.25=>'79,51.6', 
85.5=>'78.8,52.3', 
85.75=>'78.6,53', 
86=>'79.1,52.5', 
86.25=>'79.7,51.9', 
86.5=>'80.2,51.4', 
86.75=>'80.7,50.9', 
87=>'81.2,50.3', 
87.25=>'81.7,49.8', 
87.5=>'82.2,49.2', 
87.75=>'82.7,48.7', 
88=>'83.2,48.2', 
88.25=>'83.8,47.6', 
88.5=>'84.3,47.1', 
88.75=>'84.8,46.6', 
89=>'85.3,46', 
89.25=>'85.8,45.5', 
89.5=>'86.3,44.9', 
89.75=>'86.8,44.4', 
90=>'87.3,43.9', 
90.25=>'87.9,43.3', 
90.5=>'88.4,42.8', 
90.75=>'88.9,42.3', 
91=>'89.4,41.7', 
91.25=>'89.9,41.2', 
91.5=>'90.4,40.6', 
91.75=>'90.9,40.1', 
92=>'91.4,39.6', 
92.25=>'92,39', 
92.5=>'92.5,38.5', 
92.75=>'93,38', 
93=>'93.5,37.4', 
93.25=>'94,36.9', 
93.5=>'94.8,37.1', 
93.75=>'95.6,37.3', 
94=>'96.3,37.4', 
94.25=>'97.1,37.6', 
94.5=>'96.6,38.2', 
94.75=>'96.1,38.7', 
95=>'95.5,39.2', 
95.25=>'95,39.7', 
95.5=>'94.5,40.3', 
95.75=>'93.9,40.8', 
96=>'93.4,41.3', 
96.25=>'92.9,41.9', 
96.5=>'92.3,42.4', 
96.75=>'91.8,42.9', 
97=>'91.3,43.4', 
97.25=>'90.7,44', 
97.5=>'90.2,44.5', 
97.75=>'89.7,45', 
98=>'89.1,45.6', 
98.25=>'88.6,46.1', 
98.5=>'88.1,46.6', 
98.75=>'87.5,47.2', 
99=>'87,47.7', 
99.25=>'86.5,48.2', 
99.5=>'85.9,48.7', 
99.75=>'85.4,49.3', 
100=>'84.9,49.8', 
100.25=>'84.3,50.3', 
100.5=>'83.8,50.9', 
100.75=>'83.3,51.4',
);

/*
$markers = array(
0.25=>'22,50', 
0.5=>'21.6,49.4', 
0.75=>'21.1,48.7', 
1=>'20.7,48.1', 
1.25=>'20.3,47.5', 
1.5=>'19.9,46.8', 
1.75=>'19.5,46.2', 
2=>'19.1,45.6', 
2.25=>'18.7,44.9', 
2.5=>'18.3,44.3', 
2.75=>'17.8,43.7', 
3=>'17.4,43.1', 
3.25=>'17,42.4', 
3.5=>'16.6,41.8', 
3.75=>'16.2,41.2', 
4=>'15.8,40.5', 
4.25=>'15.4,39.9', 
4.5=>'15,39.3', 
4.75=>'14.5,38.6', 
5=>'14.1,38', 
5.25=>'13.4,38', 
5.5=>'12.7,38', 
5.75=>'12,37.9', 
6=>'11.3,37.9', 
6.25=>'10.6,37.9', 
6.5=>'9.8,37.9', 
6.75=>'9.1,37.9', 
7=>'8.7,37.2', 
7.25=>'8.3,36.5', 
7.5=>'7.9,35.8', 
7.75=>'7.5,35.1', 
8=>'7.1,34.4', 
8.25=>'7.9,34.3', 
8.5=>'8.6,34.3', 
8.75=>'9.4,34.3', 
9=>'10.1,34.2', 
9.25=>'10.9,34.2', 
9.5=>'11.6,34.1', 
9.75=>'11.3,33.5', 
10=>'10.9,32.8', 
10.25=>'10.6,32.2', 
10.5=>'10.2,31.5', 
10.75=>'9.8,30.9', 
11=>'9.5,30.2', 
11.25=>'9.1,29.6', 
11.5=>'8.8,28.9', 
11.75=>'8.4,28.3', 
12=>'8.1,27.6', 
12.25=>'7.7,27', 
12.5=>'7.3,26.3', 
12.75=>'7,25.7', 
13=>'6.6,25', 
13.25=>'6.3,24.4', 
13.5=>'5.9,23.7', 
13.75=>'5.6,23.1', 
14=>'5.2,22.4', 
14.25=>'4.8,21.8', 
14.5=>'4.5,21.1', 
14.75=>'4.1,20.5', 
15=>'4.9,20.4', 
15.25=>'5.6,20.3', 
15.5=>'6.4,20.3', 
15.75=>'7.1,20.2', 
16=>'7.9,20.1', 
16.25=>'8.6,20', 
16.5=>'9,20.6', 
16.75=>'9.3,21.3', 
17=>'9.6,21.9', 
17.25=>'10,22.6', 
17.5=>'10.3,23.2', 
17.75=>'10.6,23.9', 
18=>'11,24.5', 
18.25=>'11.3,25.1', 
18.5=>'11.6,25.8', 
18.75=>'12,26.4', 
19=>'12.3,27.1', 
19.25=>'12.6,27.7', 
19.5=>'13,28.3', 
19.75=>'13.3,29', 
20=>'13.7,29.6', 
20.25=>'14,30.3', 
20.5=>'14.3,30.9', 
20.75=>'14.7,31.6', 
21=>'15,32.2', 
21.25=>'15.3,32.8', 
21.5=>'15.7,33.5', 
21.75=>'16,34.1', 
22=>'16.8,34.2', 
22.25=>'17.5,34.2', 
22.5=>'18.3,34.3', 
22.75=>'19,34.4', 
23=>'19.8,34.4', 
23.25=>'20.5,34.5', 
23.5=>'21.3,34.5', 
23.75=>'22,34.6', 
24=>'22.8,34.6', 
24.25=>'23.5,34.7', 
24.5=>'24.3,34.8', 
24.75=>'24.6,35.5', 
25=>'24.9,36.3', 
25.25=>'25.2,37', 
25.5=>'25.5,37.8', 
25.75=>'25.8,38.5', 
26=>'25,38.5', 
26.25=>'24.2,38.5', 
26.5=>'23.5,38.5', 
26.75=>'22.7,38.5', 
27=>'21.9,38.4', 
27.25=>'21.2,38.4', 
27.5=>'20.4,38.4', 
27.75=>'19.7,38.4', 
28=>'18.9,38.4', 
28.25=>'18.1,38.4', 
28.5=>'18.5,39', 
28.75=>'18.9,39.6', 
29=>'19.3,40.2', 
29.25=>'19.8,40.8', 
29.5=>'20.2,41.4', 
29.75=>'20.6,42', 
30=>'21,42.6', 
30.25=>'21.4,43.2', 
30.5=>'21.8,43.8', 
30.75=>'22.2,44.4', 
31=>'22.6,45', 
31.25=>'23,45.6', 
31.5=>'23.4,46.2', 
31.75=>'23.8,46.8', 
32=>'24.2,47.4', 
32.25=>'24.6,48', 
32.5=>'25.1,48.6', 
32.75=>'25.5,49.2', 
33=>'25.9,49.8', 
33.25=>'26.3,50.4', 
33.5=>'26.7,51', 
33.75=>'27.1,51.6', 
34=>'27.5,52.3', 
34.25=>'28.3,52.3', 
34.5=>'29,52.3', 
34.75=>'29.8,52.3', 
35=>'30.6,52.3', 
35.25=>'31.3,52.3', 
35.5=>'32.1,52.3', 
35.75=>'32.8,52.3', 
36=>'33.6,52.4', 
36.25=>'34.4,52.4', 
36.5=>'35.1,52.4', 
36.75=>'34.8,51.7', 
37=>'34.5,51', 
37.25=>'34.2,50.3', 
37.5=>'33.9,49.6', 
37.75=>'33.7,48.9', 
38=>'33.4,48.2', 
38.25=>'33.1,47.5', 
38.5=>'32.8,46.9', 
38.75=>'32.5,46.2', 
39=>'32.2,45.5', 
39.25=>'31.9,44.8', 
39.5=>'31.6,44.1', 
39.75=>'31.3,43.4', 
40=>'31,42.7', 
40.25=>'30.7,42', 
40.5=>'30.4,41.3', 
40.75=>'30.1,40.6', 
41=>'29.8,40', 
41.25=>'29.5,39.3', 
41.5=>'29.2,38.6', 
41.75=>'28.9,37.9', 
42=>'28.6,37.2', 
42.25=>'28.3,36.5', 
42.5=>'28,35.8', 
42.75=>'27.8,35.1', 
43=>'28.5,35', 
43.25=>'29.2,34.9', 
43.5=>'29.9,34.8', 
43.75=>'30.7,34.6', 
44=>'31.4,34.5', 
44.25=>'31.9,35.1', 
44.5=>'32.4,35.7', 
44.75=>'32.9,36.3', 
45=>'33.4,36.9', 
45.25=>'33.9,37.5', 
45.5=>'34.6,37.1', 
45.75=>'35.2,36.7', 
46=>'35.9,36.2', 
46.25=>'36.6,35.8', 
46.5=>'37.3,35.4', 
46.75=>'38,35.3', 
47=>'38.8,35.2', 
47.25=>'39.5,35.2', 
47.5=>'40.3,35.1', 
47.75=>'41,35', 
48=>'41.8,34.9', 
48.25=>'42.5,34.9', 
48.5=>'43.1,35.3', 
48.75=>'43.7,35.7', 
49=>'44.3,36', 
49.25=>'44.9,36.4', 
49.5=>'45.5,36.8', 
49.75=>'46.2,37.2', 
50=>'46.8,37.6', 
50.25=>'47.4,38', 
50.5=>'48.1,37.6', 
50.75=>'48.8,37.3', 
51=>'49.5,36.9', 
51.25=>'50.2,36.5', 
51.5=>'50.9,36.1', 
51.75=>'51.6,35.8', 
52=>'52.3,35.4', 
52.25=>'53,35.3', 
52.5=>'53.8,35.3', 
52.75=>'54.5,35.3', 
53=>'55.3,35.2', 
53.25=>'56,35.2', 
53.5=>'56.8,35.1', 
53.75=>'57.3,35.5', 
54=>'57.9,35.9', 
54.25=>'58.4,36.3', 
54.5=>'59,36.7', 
54.75=>'59.5,37.1', 
55=>'59.9,37.8', 
55.25=>'60.3,38.6', 
55.5=>'60.7,39.3', 
55.75=>'61.1,40', 
56=>'61,40.7', 
56.25=>'60.9,41.4', 
56.5=>'60.7,42.1', 
56.75=>'60.6,42.8', 
57=>'60.5,43.6', 
57.25=>'60.3,44.3', 
57.5=>'60.2,45', 
57.75=>'60.1,45.7', 
58=>'59.9,46.4', 
58.25=>'59.8,47.1', 
58.5=>'59.7,47.8', 
58.75=>'59.5,48.5', 
59=>'59.4,49.2', 
59.25=>'59.3,49.9', 
59.5=>'59.2,50.7', 
59.75=>'59,51.4', 
60=>'58.9,52.1', 
60.25=>'58.8,52.8', 
60.5=>'58.6,53.5', 
60.75=>'59.4,53.5', 
61=>'60.1,53.6', 
61.25=>'60.9,53.6', 
61.5=>'61.6,53.6', 
61.75=>'62.4,53.7', 
62=>'63.1,53.7', 
62.25=>'63.9,53.7', 
62.5=>'64.6,53.8', 
62.75=>'64.7,53', 
63=>'64.7,52.3', 
63.25=>'64.7,51.6', 
63.5=>'64.8,50.8', 
63.75=>'64.8,50.1', 
64=>'64.8,49.4', 
64.25=>'64.9,48.6', 
64.5=>'64.9,47.9', 
64.75=>'65,47.2', 
65=>'65,46.5', 
65.25=>'65,45.7', 
65.5=>'65.1,45', 
65.75=>'65.1,44.3', 
66=>'65.1,43.5', 
66.25=>'65.2,42.8', 
66.5=>'65.2,42.1', 
66.75=>'65.2,41.4', 
67=>'65.3,40.6', 
67.25=>'65.3,39.9', 
67.5=>'65.4,39.2', 
67.75=>'65.4,38.4', 
68=>'65.4,37.7', 
68.25=>'65.5,37', 
68.5=>'65.5,36.3', 
68.75=>'66.2,36.1', 
69=>'67,36', 
69.25=>'67.7,35.9', 
69.5=>'68.4,35.8', 
69.75=>'69.1,35.7', 
70=>'69.9,35.6', 
70.25=>'69.8,36.4', 
70.5=>'69.7,37.1', 
70.75=>'69.6,37.8', 
71=>'69.5,38.6', 
71.25=>'69.5,39.3', 
71.5=>'69.4,40', 
71.75=>'69.3,40.8', 
72=>'69.2,41.5', 
72.25=>'69.1,42.2', 
72.5=>'69.1,43', 
72.75=>'69,43.7', 
73=>'68.9,44.4', 
73.25=>'68.8,45.2', 
73.5=>'68.7,45.9', 
73.75=>'68.7,46.6', 
74=>'68.6,47.4', 
74.25=>'68.5,48.1', 
74.5=>'68.4,48.8', 
74.75=>'68.3,49.6', 
75=>'68.2,50.3', 
75.25=>'68.2,51', 
75.5=>'68.1,51.8', 
75.75=>'68,52.5', 
76=>'68.5,52', 
76.25=>'69,51.4', 
76.5=>'69.5,50.9', 
76.75=>'70,50.3', 
77=>'70.5,49.8', 
77.25=>'71.1,49.2', 
77.5=>'71.6,48.7', 
77.75=>'72.1,48.1', 
78=>'72.6,47.6', 
78.25=>'73.1,47.1', 
78.5=>'73.6,46.5', 
78.75=>'74.1,46', 
79=>'74.6,45.4', 
79.25=>'75.1,44.9', 
79.5=>'75.8,44.7', 
79.75=>'76.4,44.5', 
80=>'77.1,44.3', 
80.25=>'77.7,44.1', 
80.5=>'78.4,43.9', 
80.75=>'78.8,44.4', 
81=>'79.3,44.9', 
81.25=>'79.8,45.5', 
81.5=>'80.3,46', 
81.75=>'80.1,46.7', 
82=>'79.9,47.4', 
82.25=>'79.8,48.1', 
82.5=>'79.6,48.8', 
82.75=>'79.4,49.5', 
83=>'79.3,50.2', 
83.25=>'79.1,50.9', 
83.5=>'79,51.6', 
83.75=>'78.8,52.3', 
84=>'78.6,53', 
84.25=>'79.1,52.5', 
84.5=>'79.7,51.9', 
84.75=>'80.2,51.4', 
85=>'80.7,50.9', 
85.25=>'81.2,50.3', 
85.5=>'81.7,49.8', 
85.75=>'82.2,49.2', 
86=>'82.7,48.7', 
86.25=>'83.2,48.2', 
86.5=>'83.8,47.6', 
86.75=>'84.3,47.1', 
87=>'84.8,46.6', 
87.25=>'85.3,46', 
87.5=>'85.8,45.5', 
87.75=>'86.3,44.9', 
88=>'86.8,44.4', 
88.25=>'87.3,43.9', 
88.5=>'87.9,43.3', 
88.75=>'88.4,42.8', 
89=>'88.9,42.3', 
89.25=>'89.4,41.7', 
89.5=>'89.9,41.2', 
89.75=>'90.4,40.6', 
90=>'90.9,40.1', 
90.25=>'91.4,39.6', 
90.5=>'92,39', 
90.75=>'92.5,38.5', 
91=>'93,38', 
91.25=>'93.5,37.4', 
91.5=>'94,36.9', 
91.75=>'94.8,37.1', 
92=>'95.6,37.3', 
92.25=>'96.3,37.4', 
92.5=>'97.1,37.6', 
92.75=>'96.6,38.2', 
93=>'96.1,38.7', 
93.25=>'95.5,39.2', 
93.5=>'95,39.7', 
93.75=>'94.5,40.3', 
94=>'93.9,40.8', 
94.25=>'93.4,41.3', 
94.5=>'92.9,41.9', 
94.75=>'92.3,42.4', 
95=>'91.8,42.9', 
95.25=>'91.3,43.4', 
95.5=>'90.7,44', 
95.75=>'90.2,44.5', 
96=>'89.7,45', 
96.25=>'89.1,45.6', 
96.5=>'88.6,46.1', 
96.75=>'88.1,46.6', 
97=>'87.5,47.2', 
97.25=>'87,47.7', 
97.5=>'86.5,48.2', 
97.75=>'85.9,48.7', 
98=>'85.4,49.3', 
98.25=>'84.9,49.8', 
98.5=>'84.3,50.3', 
98.75=>'83.8,50.9', 
99=>'83.3,51.4', 
99.25=>'82.7,51.9', 
99.5=>'82.2,52.4', 
99.75=>'81.7,53', 
100=>'81.1,53.5', 
);*/

$sql = "SELECT IF( c.value = 'yes', 'true', 'false' ) AS game_status, c2.value AS RFHandleId, c3.value AS force_progress, c4.value AS new_game
		FROM config c
		LEFT JOIN config c2 ON c2.key = 'player'
		LEFT JOIN config c3 ON c3.key = 'progress'
		LEFT JOIN config c4 ON c4.key = 'new_game'
		WHERE c.key = 'game_active'";
$game_info = $pdo->query($sql)->fetch();

if($game_info['force_progress'] == 100)
	$percent = 100;
else
{
	$sql = "SELECT * FROM player_progress WHERE player_guid='{$game_info['RFHandleId']}' ORDER BY `time` DESC LIMIT 1";
	foreach($pdo->query($sql) as $row)
	{
		$distance = 1000;
		$percent = 0;
		foreach($markers as $pc => $marker)
		{
			list($x, $y) = explode(',', $marker);
			$temp_distance = get_distance($row['x'], $row['y'], $x, $y);
			if($temp_distance < $distance)
			{
				$distance = $temp_distance;
				$percent = $pc;
			}
		}
	}
}

// set the previous_pc if it's not already set or a new game has started
if(!isset($_SESSION['previous_pc']) || $game_info['new_game'] == 'yes')
{
	$_SESSION['previous_pc'] = 0;
	
	$sql = "UPDATE config SET `value` = 'no' WHERE `key`='new_game'";
	$pdo->query($sql);
}

// is the current % less than the last or too big a jump forward
if($percent < ($_SESSION['previous_pc']) || $percent > ($_SESSION['previous_pc'] + $positive_threshold) )
	$percent = $_SESSION['previous_pc'];
else
	$_SESSION['previous_pc'] = $percent;

// fix for front end lightbox and trigger game end event because arduino circuit might not
if(intval($percent) == 100)
{
	$sql = "UPDATE config SET `value` = 'no' WHERE `key`='game_active'";
	$pdo->query($sql);
}

$json_data = array('RFHandleId'=>$game_info['RFHandleId'], 'game_status'=>($game_info['game_status'] == 'true'), 'game_progress'=>$percent, 'game_time'=>time());

header('Content-type: application/json');
echo json_encode($json_data);
exit;

function get_distance($x1, $y1, $x2, $y2)
{
	$side1 = abs($x1 - $x2);
	$side2 = abs($y1 - $y2);
	return sqrt($side1 * $side1 + $side2 * $side2);
}